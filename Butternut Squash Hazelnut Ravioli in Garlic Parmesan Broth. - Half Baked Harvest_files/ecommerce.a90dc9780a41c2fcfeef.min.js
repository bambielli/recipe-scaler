!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("dom")):"function"==typeof define&&define.amd?define("ecommerce",["dom"],e):"object"==typeof exports?exports.ecommerce=e(require("dom")):(t.Chicory=t.Chicory||{},t.Chicory.ecommerce=e(t.dom))}("undefined"!=typeof self?self:this,function(t){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="https://prod-cdn.chicoryapp.com/chicory-smartcart-ui/",e(e.s=152)}({152:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=i(n(51)),a=i(n(153)),s=i(n(154)),c=i(n(155)),u=document.currentScript.src,l=u.substr(0,u.lastIndexOf("/")),d=u.split("/")[0]+"//"+u.split("/")[2],f="lower-right",p="below-ingredient",h="below-recipe",m="below-post",b="custom",v="none",g={STYLED:a.default,UNSTYLED:s.default,THEDAILYMEAL:c.default},y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.settings={},this.instances={},this.$smartcart=null}return r(t,[{key:"deactivate",value:function(){var t=this;Object.keys(this.instances).forEach(function(e){t.instances[e].button.remove()}),t.$smartcart&&t.$smartcart.remove(),t.settings={},t.$page=null,t.$button=null,t.$smartcart=null}},{key:"activate",value:function(t){t.recipes||(t.recipes=[{url:t.recipe.source_uri,recipe:t.recipe,selector:null}]),this.load(t).then(this.run.bind(this)).done()}},{key:"load",value:function(t){var e=this;return new Promise(function(n){if(this.$page=o.default.getPageStructure(),o.default.extend(e.settings,t),!(t.host.button_template in g))throw new Error("Chicory: Settings did not specify a valid button template.");o.default.get(g[t.host.button_template],{},{},"text").then(function(i){Object.keys(t.recipes).forEach(function(n){var r=null;t.buttons&&(r=t.buttons[n].selector),e.instances[t.recipes[n].url]={selector:r,button:(0,o.default)(i),recipe:t.recipes[n].recipe}}),n()}.bind(this)).done()}.bind(this))}},{key:"run",value:function(){this.injectButtons()}},{key:"injectButtons",value:function(){var t=this,e=0;return Object.keys(t.instances).forEach(function(n){if(t.instances[n].recipe)if(t.instances[n].selector){var i=(0,o.default)(t.instances[n].selector);if(!i)throw new Error("Chicory: Could not find selector.");i.append(t.instances[n].button);var r=t.getButtonEventData(t.instances[n].recipe);t.instances[n].button.on("click",function(e){e.preventDefault(),t.injectSmartCart(t.instances[n].recipe),o.default.send("click_button",r,t.instances[n].recipe)}.bind(t)),o.default.send("load_button",r,t.instances[n].recipe),e+=1}else{t.button=t.instances[n].button,t.settings.recipe=t.instances[n].recipe;t.injectButton(t.settings.location)||o.default.log(new Error("Chicory: Cannot inject button. (LOCATION:"+t.settings.location+")."))}}),e}},{key:"injectButton",value:function(t){var e=(0,o.default)("div.chicory-order-ingredients").viewable();switch(e.length&&(t=b),t){case f:var n=this.$page.preps;if(!n.length)return this.injectButton(p);this.$button.css("float","right"),this.$button.css("margin-right","5px"),n.prepend(this.button);break;case p:var i=this.$page.ingredients;if(!i.length)return this.injectButton(h);i.append(this.button);break;case h:var r=this.$page.recipe;if(!r.length)return this.injectButton(m);r.append(this.button);break;case m:var a=this.$page.post;if(!a.length)return this.injectButton(v);a.append(this.button);break;case b:if(!e.length)return this.injectButton(v);e.append(this.button);break;case v:return;default:return this.injectButton(p)}var s=this.getButtonEventData(this.settings.recipe);return this.button.on("view",function(t){o.default.send("view_button",s)}.bind(this)),this.button.on("click",function(t){t.preventDefault(),this.injectSmartCart(this.settings.recipe),o.default.send("click_button",s)}.bind(this)),o.default.send("load_button",s),console.log("Chicory: injecting button at location: "+t),t}},{key:"getButtonEventData",value:function(t){return{parser_version:t.parser_version,is_published_v1:t.is_published_v1,is_published_v2:t.is_published_v2,zip_code:this.settings.zip_code}}},{key:"injectSmartCart",value:function(t){var e=this.$smartcart=(0,o.default)('<div style="z-index: 999999 !important; position: fixed !important; top: 0 !important; bottom: 0 !important; left: 0 !important; right: 0 !important;"></div>'),n=(0,o.default)("meta[name='viewport']");n.length||(n=(0,o.default)('<meta name="viewport">'),(0,o.default)("head").append(n));var i=(0,o.default)("html");i&&i.css("overflow","hidden");var r=n.attr("content");n.attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");var a=document.createElement("template");a.innerHTML='<iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" id="chicory-smartcart" name="chicory-smartcart" src="'+l+'/" frameborder="0" height="100%" width="100%" data-settings="'+JSON.stringify(this.settings)+'" allowfullscreen>';var s=a.content.firstChild;document.body.appendChild(s),(0,o.default)("body").append(e),e.append((0,o.default)(s)),this.wait(s,"chicory.smartcart.init").then(function(){this.send(s,"load",{settings:o.default.extend({recipe:t},this.settings)})}.bind(this)).done(),window.addEventListener("message",function(t){var e=new RegExp(d.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");if(t.origin.match(e)&&t.source===s.contentWindow){var i=JSON.parse(t.data);if("chicory.smartcart.event"===i.method){if("close_cart"===i.name){document.getElementById("chicory-smartcart").parentNode.remove(),n.attr("content",r);var a=(0,o.default)("html");a&&a.css("overflow","scroll")}o.default.send(i.name,i.data)}}},!1)}},{key:"send",value:function(t,e,n){return new Promise(function(i){this.wait(t,e).then(function(t){i(t)}).done(),t.contentWindow.postMessage({method:e,args:n},d)}.bind(this))}},{key:"wait",value:function(t,e){return new Promise(function(n){window.addEventListener("message",function i(r){var o=new RegExp(d.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");if(r.origin.match(o)&&r.source===t.contentWindow){var a=JSON.parse(r.data);a.method===e&&(window.removeEventListener("message",i),n(a.resp))}},!1)}.bind(this))}}]),t}();e.default=new y},153:function(t,e,n){t.exports=n.p+"templates/739c805ee1dbadcff62ee67e76d694aa.button"},154:function(t,e,n){t.exports=n.p+"templates/4ad8a8adb9e95372f1a23521fbb28d4c.button"},155:function(t,e,n){t.exports=n.p+"templates/827b06f5380c957657984c46b8d687d1.button"},51:function(e,n){e.exports=t}})});
//# sourceMappingURL=ecommerce.a90dc9780a41c2fcfeef.min.js.map